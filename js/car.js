"use strict";$(".nav-right-left").mousemove(function(){window.event;$(".app").css({display:"block"})}),$(".nav-right-left").mouseout(function(){$(".app").css({display:"none"})}),$(".city").mousemove(function(){window.event;$(".city-list").css({display:"block"})}),$(".city").mouseout(function(){$(".city-list").css({display:"none"})}),$("#news").mousemove(function(){window.event;$(".news-list").css({display:"block"})}),$("#news").mouseout(function(){$(".news-list").css({display:"none"})});var login=localStorage.getItem("login");function render(t){var n,e;t.length?(n=shopNum(t),e=' <ul class="thead-ul">\n        <li class="ul-list1">商品</li>\n        <li class="ul-list2">生日牌</li>\n        <li class="ul-list3">单价</li>\n        <li class="ul-list4">数量</li>\n        <li class="ul-list5">金额</li>\n    </ul>',t.forEach(function(t){e+='<div class="shop-car">\n        <section class="car-list">\n            <figure>\n                <img src="'+t.cake_photo+'" alt="">\n                <figcaption>\n                    <p>StrawberryFool'+t.cake_name+'</p>\n                    <h3>规格: 454g(1.0磅)</h3>\n                    <h4><i></i>赠送5套餐具</h4>\n                </figcaption>\n            </figure>\n            <p class="birthday-car"><select name="" id="">\n                <option value="">生日快乐</option>\n                <option value="">节日快乐</option>\n                <option value="">Happy Birthday</option>\n                <option value="">纪念日快乐</option>\n                <option value="">平安夜快乐</option>\n                <option value="">圣诞节快乐</option>\n            </select></p>\n            <span class="cake-price">￥'+t.cake_price+'</span>\n            <p id="btn">\n                <button class="reduce" cake_id='+t.id+'>-</button>\n                <button class="num">'+t.buy_number+'</button>\n                <button class="add" cake_id='+t.id+'>+</button>\n            </p>\n            <span class="total-price">￥'+(t.cake_price*t.buy_number).toFixed(2)+'</span>\n            <a> <i class="del" goods_id="'+t.id+'"></i></a>\n        </section>\n    </div>'}),e+='<div class="cart-submit">\n    <a href="#" class="cart-submit-empty qingkong" ><i></i>全部清空</a>\n    <ul class="cart-total-detail"><li>商品金额：¥ '+n.totalPrice.toFixed(2)+'</li> \x3c!--- <li>配送费：¥ 0.00</li> ---\x3e <li>活动优惠：¥ 0.00</li></ul>\n    <div class="cart-total"><span>合计：¥<span>'+n.totalPrice.toFixed(2)+'</span></span></div>\n    <span class="cart-balance" id="cost-freight-tip"></span>\n\n    <div class="cart-submit-button"><a href="" class="jieSuan">去结算</a></div>\n            \n</div>',$(".container").html(e)):$("#content").html('<div class="cart-not-pro">\n        <img src="//static.21cake.com/themes/site/img/cartempty.png">\n        <span>您的购物车里还没有商品</span>\n        <a href="./listcake.html">去购物 &gt;&gt;</a>\n    </div>')}function shopNum(t){return{totalPrice:t.filter(function(t){return 0==t.is_select}).reduce(function(t,n){return t+n.cake_price*n.buy_number},0)}}login||(location.href="./login.html"),$(".not-login").html(login).css({color:"blue"}),$.ajax({url:"../api/getCarData.php",method:"get",data:{username:login},dataType:"json",async:!0,success:function(t){console.log(t),localStorage.setItem("cakelist",JSON.stringify(t)),render(t)},error:function(t){console.log(t)}});var container=document.querySelector(".container");container.onclick=function(){var n,e,a,i,s,o,l,c,r,t=window.event;t.target.classList.contains("del")&&(n=t.target.getAttribute("goods_id"),pAjax({url:"../api/removeCarData.php",data:{username:login,id:n}}).then(function(t){t.code&&(t=JSON.parse(localStorage.getItem("cakelist")).filter(function(t){return t.id!=n}),localStorage.setItem("cakelist",JSON.stringify(t)),render(t))})),t.target.classList.contains("reduce")&&(e=JSON.parse(localStorage.getItem("cakelist")),a=t.target.getAttribute("cake_id"),i=e.filter(function(t){return t.id==a})[0],(s=+i.buy_number)<=1?s=1:s--,pAjax({url:"../api/updCarData.php",data:{username:login,id:a,cake_num:s}}).then(function(t){t.code&&(i.buy_number=s,localStorage.setItem("cakelist",JSON.stringify(e)),render(e))})),t.target.classList.contains("add")&&(o=JSON.parse(localStorage.getItem("cakelist")),l=t.target.getAttribute("cake_id"),c=o.filter(function(t){return t.id==l})[0],r=+c.buy_number,r++,pAjax({url:"../api/updCarData.php",data:{username:login,id:l,cake_num:r}}).then(function(t){t.code&&(c.buy_number=r,localStorage.setItem("cakelist",JSON.stringify(o)),render(o))})),t.target.classList.contains("qingkong")&&pAjax({url:"../api/clearCarData.php",data:{username:login}}).then(function(t){t.code&&(localStorage.setItem("cakelist",JSON.stringify(t)),render(t))}),t.target.classList.contains("jieSuan")&&(JSON.parse(localStorage.getItem("cakelist")).forEach(function(t){pAjax({url:"../api/removecarData.php",data:{username:login,id:t.id}}).then(function(t){console.log(t)})}),alert("支付成功,欢迎下次光临"))};